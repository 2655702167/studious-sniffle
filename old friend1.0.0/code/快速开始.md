# 🚀 快速开始指南

**5分钟快速体验语音支付功能**

---

## 📋 前置条件

- ✅ 已安装微信开发者工具
- ✅ 已有小程序AppID
- ✅ 已有后端服务器（或使用mock数据）

---

## ⚡ 快速体验（前端）

### Step 1: 复制文件（30秒）

```bash
# 进入小程序项目目录
cd C:\Users\28614\Desktop\作业\软工\minicode-1\pages

# 创建语音支付页面目录
mkdir voice_payment

# 复制前端文件
copy ..\..\code\voice_payment.* voice_payment\
```

### Step 2: 注册页面（15秒）

在 `minicode-1/app.json` 中添加：

```json
{
  "pages": [
    "pages/voice_payment/voice_payment"
  ]
}
```

### Step 3: 使用Mock数据测试（1分钟）

修改 `voice_payment.js`，添加mock响应：

```javascript
uploadAndRecognize: function(filePath) {
  const that = this;
  
  // ========== Mock数据（测试用） ==========
  setTimeout(() => {
    const mockResponse = {
      success: true,
      reply_text: "您要缴纳水费，金额85.60元。请说"确认"继续支付",
      session_id: "MOCK_SESSION_123",
      next_action: "continue"
    };
    that.handleVoicePaymentResponse(mockResponse);
  }, 1500);
  return; // 暂时不调用真实API
  // ========================================
  
  // 真实API调用代码...
}
```

### Step 4: 打开测试（10秒）

1. 用微信开发者工具打开 `minicode-1` 项目
2. 编译运行
3. 点击"语音支付"页面
4. 按住"按住说话"按钮测试

**预期效果：**
- ✅ 按钮可以按住/松开
- ✅ 录音时有红色提示
- ✅ 松开后显示模拟回复文本

---

## 🔧 集成真实后端（5分钟）

### Step 1: 配置百度语音API（2分钟）

访问 https://ai.baidu.com/
- 注册/登录
- 创建应用 → 选择"语音识别"
- 复制 API Key 和 Secret Key

在 `config/app.ini` 中配置：

```ini
[baidu_voice]
api_key = YOUR_BAIDU_API_KEY
secret_key = YOUR_BAIDU_SECRET_KEY
```

### Step 2: 启动后端服务（1分钟）

```bash
# 进入后端目录
cd C:\Users\28614\Desktop\作业\软工\service

# 编译并运行
mkdir build && cd build
cmake ..
make
./payment_service
```

### Step 3: 修改前端API地址（1分钟）

在 `voice_payment.js` 中，全局替换：

```javascript
// 将 https://your-api.com 替换为实际地址
const API_BASE_URL = 'http://localhost:8080'; // 或你的服务器地址

wx.request({
  url: `${API_BASE_URL}/api/payment/voice-pay`,
  // ...
});
```

### Step 4: 真机测试（1分钟）

1. 点击开发者工具中的"预览"
2. 用微信扫码
3. 说话测试语音识别

---

## 🎯 测试话术示例

### 场景1：查询待缴费

```
👤 用户: "查询待缴费"
🤖 系统: "您有3项待缴费用：水费85.6元、电费126.3元、网费99元。请问您要缴哪一项？"
```

### 场景2：缴纳指定费用

```
👤 用户: "我要缴水费"
🤖 系统: "您要缴纳水费，金额85.60元。请说"确认"继续支付，或说"取消"放弃"

👤 用户: "确认"
🤖 系统: "已为您发起水费支付，请在微信中完成支付"
```

### 场景3：模糊查询

```
👤 用户: "我要缴费"
🤖 系统: "我可以帮您缴纳水费、电费、网费、话费。请问您要缴哪一项？"

👤 用户: "电费"
🤖 系统: "您要缴纳电费，金额126.30元。请说"确认"继续支付"
```

---

## 🐛 快速问题排查

### 问题1：录音无反应

**检查：**
```bash
# 1. 查看权限配置
在 app.json 中确认有 scope.record 权限声明

# 2. 真机测试
模拟器不支持录音，必须用真机测试
```

### 问题2：识别失败

**检查：**
```bash
# 1. 检查API配置
cat config/app.ini | grep baidu

# 2. 测试API连通性
curl https://vop.baidu.com/server_api

# 3. 查看日志
tail -f logs/voice_payment.log
```

### 问题3：TTS无声音

**检查：**
```bash
# 1. 确认插件引入
在 app.json 中确认有 WechatSI 插件

# 2. 检查手机音量
调高媒体音量

# 3. 降级方案
注释掉 TTS 代码，仅显示文字
```

---

## 📚 完整文档导航

| 文档 | 说明 | 适合人群 |
|------|------|---------|
| [快速开始](./快速开始.md) | 5分钟快速体验（本文档） | 所有人 |
| [README](./README.md) | 功能介绍、技术架构 | 产品经理、开发者 |
| [API文档](./API文档.md) | 接口定义、参数说明 | 后端开发者 |
| [集成指南](./集成指南.md) | 完整部署流程 | 运维、前后端开发 |
| [项目完成说明](./项目完成说明.md) | 交付物清单、技术亮点 | 项目经理、团队成员 |

---

## 🎓 学习路径

### 初学者（1-2天）

1. ✅ 阅读 [快速开始](./快速开始.md) - 体验功能
2. ✅ 阅读 [README](./README.md) - 理解整体架构
3. ✅ 修改UI样式 - 练习前端开发
4. ✅ 添加日志输出 - 理解代码逻辑

### 进阶开发者（3-5天）

1. ✅ 阅读 [API文档](./API文档.md) - 理解接口设计
2. ✅ 阅读 [集成指南](./集成指南.md) - 完整部署
3. ✅ 修改语音识别逻辑 - 提升准确率
4. ✅ 添加新功能 - 如语音修改金额

### 高级开发者（1周）

1. ✅ 重构代码 - 使用设计模式优化
2. ✅ 性能调优 - 压测、优化响应时间
3. ✅ 集成大模型 - 升级为AI对话
4. ✅ 横向扩展 - 支持其他支付场景

---

## 💡 快速Tips

### 提高识别准确率

```cpp
// 在 voice_recognition.h 中调整置信度阈值
if (result.confidence < 0.80) {  // 原: 0.90
    // 降低阈值，提高召回率
}
```

### 调整会话过期时间

```cpp
// 在 voice_payment_service.h 中修改
session.expire_time = session.create_time + 300; // 原: 180秒 → 300秒（5分钟）
```

### 自定义语音回复

```cpp
// 在 voice_payment_service.h 中修改提示语
response.reply_text = "亲，您要缴啥费呀？"; // 更亲切的表达
```

### 添加新的缴费类型

```cpp
// 在 voice_recognition.h 中添加
std::map<std::string, std::vector<std::string>> type_keywords = {
    {"水费", {"水费", "水电", "自来水"}},
    {"燃气费", {"燃气费", "天然气", "煤气费"}}  // 新增
};
```

常见问题优先查看 [集成指南 - 常见问题](./集成指南.md#常见问题排查)

