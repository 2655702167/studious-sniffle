# 🚀 快速修复并启动指南

## 问题诊断

✅ 已发现问题：
1. ❌ Maven未安装（不影响，可以用IDE直接运行）
2. ❌ 数据库表未创建（需要修复）

---

## 🔧 解决方案（3步搞定）

### 步骤1：创建数据库表（重要！）

#### 方法1：使用Navicat（推荐）

1. 打开Navicat，连接到MySQL
2. 右键"连接" → "新建数据库"
3. 数据库名：`elderly_assistant`
4. 字符集：`utf8mb4`
5. 点击"确定"

6. 双击打开`elderly_assistant`数据库
7. 点击"查询" → "新建查询"
8. 复制下面的SQL并执行：

```sql
USE elderly_assistant;

-- 创建用户表
DROP TABLE IF EXISTS USER_BASE;
CREATE TABLE USER_BASE (
    user_id VARCHAR(50) PRIMARY KEY COMMENT '用户ID',
    user_name VARCHAR(50) NOT NULL COMMENT '姓名',
    user_age INT DEFAULT 0 COMMENT '年龄',
    phone VARCHAR(200) NOT NULL COMMENT '手机号',
    dialect_type VARCHAR(20) DEFAULT 'zh' COMMENT '方言类型',
    avatar_url VARCHAR(200) COMMENT '头像URL',
    create_time BIGINT NOT NULL COMMENT '注册时间',
    update_time BIGINT DEFAULT 0 COMMENT '更新时间'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户基础表';

-- 创建缴费配置表
DROP TABLE IF EXISTS PAYMENT_CONFIG;
CREATE TABLE PAYMENT_CONFIG (
    config_id VARCHAR(50) PRIMARY KEY COMMENT '配置ID',
    user_id VARCHAR(50) NOT NULL COMMENT '用户ID',
    payment_type VARCHAR(20) NOT NULL COMMENT '缴费类型',
    account_number VARCHAR(100) COMMENT '账号',
    default_amount DECIMAL(10,2) DEFAULT 0.00 COMMENT '默认金额',
    status VARCHAR(20) DEFAULT '正常' COMMENT '状态',
    due_date VARCHAR(20) COMMENT '到期日期',
    bill_month VARCHAR(20) COMMENT '账单月份',
    remark VARCHAR(200) COMMENT '备注',
    create_time BIGINT NOT NULL COMMENT '创建时间',
    update_time BIGINT DEFAULT 0 COMMENT '更新时间',
    last_pay_time BIGINT DEFAULT 0 COMMENT '上次缴费时间'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='缴费配置表';

-- 插入测试用户
INSERT INTO USER_BASE (user_id, user_name, user_age, phone, dialect_type, avatar_url, create_time, update_time) 
VALUES ('USER_123', '张大爷', 68, 'encrypted_phone', 'zh', 'https://example.com/avatar.jpg', UNIX_TIMESTAMP()*1000, UNIX_TIMESTAMP()*1000);

-- 插入测试缴费数据
INSERT INTO PAYMENT_CONFIG (config_id, user_id, payment_type, account_number, default_amount, status, due_date, bill_month, remark, create_time, update_time, last_pay_time) 
VALUES 
('PAY_ITEM_001', 'USER_123', '电费', '****1234', 126.30, '欠费', '2025-12-05', '2025-11', '2025年11月电费账单', UNIX_TIMESTAMP()*1000, UNIX_TIMESTAMP()*1000, 0),
('PAY_ITEM_002', 'USER_123', '水费', '****5678', 45.60, '欠费', '2025-12-10', '2025-11', '2025年11月水费账单', UNIX_TIMESTAMP()*1000, UNIX_TIMESTAMP()*1000, 0),
('PAY_ITEM_003', 'USER_123', '网费', '****9012', 99.00, '欠费', '2025-12-15', '2025-11', '2025年11月宽带费', UNIX_TIMESTAMP()*1000, UNIX_TIMESTAMP()*1000, 0);

-- 验证数据
SELECT '用户数据' AS 表名, COUNT(*) AS 记录数 FROM USER_BASE
UNION ALL
SELECT '缴费数据', COUNT(*) FROM PAYMENT_CONFIG;

SELECT * FROM PAYMENT_CONFIG WHERE user_id = 'USER_123';
```

#### 方法2：使用MySQL命令行

```bash
mysql -u root -p

# 输入密码后，执行：
CREATE DATABASE IF NOT EXISTS elderly_assistant DEFAULT CHARACTER SET utf8mb4;
USE elderly_assistant;

# 然后复制上面的SQL语句执行
```

---

### 步骤2：用IDE启动后端（无需Maven）

#### 如果你用的是IDEA：

1. 打开IDEA
2. 打开项目：`C:\Users\28614\Desktop\作业\软工\old friend\java-backend`
3. 等待IDEA自动下载依赖（右下角会显示进度）
4. 找到文件：`ElderlyAssistantApplication.java`
5. 右键文件 → 选择"Run 'ElderlyAssistantApplication.main()'"

#### 如果你用的是Eclipse：

1. 打开Eclipse
2. File → Import → Maven → Existing Maven Projects
3. 选择目录：`C:\Users\28614\Desktop\作业\软工\old friend\java-backend`
4. 等待依赖下载完成
5. 找到`ElderlyAssistantApplication.java`
6. 右键 → Run As → Java Application

#### 如果你用的是VSCode：

1. 安装插件：Java Extension Pack
2. 打开文件夹：`java-backend`
3. 等待依赖下载
4. 打开`ElderlyAssistantApplication.java`
5. 点击`main`方法上方的"Run"按钮

---

### 步骤3：测试后端

启动成功后，应该看到：
```
========================================
老友助手后端服务启动成功！
访问地址: http://localhost:8080/api
========================================
```

**浏览器测试：**
```
http://localhost:8080/api/payment/unpaid-items?user_id=USER_123
```

**期望结果：**
```json
{
  "code": 0,
  "message": "success",
  "data": [
    {
      "configId": "PAY_ITEM_001",
      "userId": "USER_123",
      "paymentType": "电费",
      "accountNumber": "****1234",
      "defaultAmount": 126.30,
      "status": "欠费",
      ...
    }
  ]
}
```

---

## 🎯 如果IDE也没有，安装Maven

### Windows安装Maven（5分钟）

1. **下载Maven：**
   - 访问：https://maven.apache.org/download.cgi
   - 下载：`apache-maven-3.9.5-bin.zip`

2. **解压到C盘：**
   - 解压到：`C:\Program Files\Apache\maven`

3. **配置环境变量：**
   ```
   此电脑 → 右键"属性" → 高级系统设置 → 环境变量
   
   新建系统变量：
   变量名：MAVEN_HOME
   变量值：C:\Program Files\Apache\maven
   
   编辑Path变量，添加：
   %MAVEN_HOME%\bin
   ```

4. **验证安装：**
   ```bash
   # 重新打开CMD
   mvn -version
   ```

---

## ✅ 启动检查清单

- [ ] MySQL服务已启动
- [ ] 数据库`elderly_assistant`已创建
- [ ] 表`USER_BASE`和`PAYMENT_CONFIG`已创建
- [ ] 测试数据已插入（3条缴费记录）
- [ ] IDE已打开项目（或Maven已安装）
- [ ] 后端启动成功（看到"启动成功"提示）
- [ ] 浏览器可以访问API接口
- [ ] API返回正确的JSON数据

---

## 🔍 常见错误排查

### 错误1：Table doesn't exist
**原因：** 数据库表未创建  
**解决：** 执行步骤1的SQL语句

### 错误2：Could not connect to MySQL
**原因：** MySQL未启动或密码错误  
**解决：** 
- 检查MySQL服务是否运行
- 检查`application.yml`中的用户名密码

### 错误3：Port 8080 already in use
**原因：** 8080端口被占用  
**解决：** 
- 关闭其他占用8080端口的程序
- 或修改`application.yml`中的端口号

---

## 📞 需要帮助？

如果遇到问题，提供以下信息：
1. 使用的IDE名称和版本
2. 错误提示的完整截图
3. 数据库查询结果：`SELECT * FROM PAYMENT_CONFIG;`

---

**现在开始执行步骤1，创建数据库表！** 🚀
